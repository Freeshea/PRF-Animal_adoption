<mat-card class="card-container" *ngIf="user">
  <mat-card-header>
    <mat-card-title>
      <span>My Profile</span>
      <span>
        <button mat-icon-button *ngIf="!isEditing" (click)="toggleEdit()">
          <mat-icon>edit</mat-icon>
        </button>
        <ng-container *ngIf="isEditing">
          <button mat-icon-button (click)="saveChanges()" [disabled]="!profileForm.valid">
            <mat-icon>check</mat-icon>
          </button>
          <button mat-icon-button (click)="toggleEdit()">
            <mat-icon>close</mat-icon>
          </button>
        </ng-container>
      </span>
    </mat-card-title>
  </mat-card-header>

  <mat-card-content>

    <form class="profile-form" [formGroup]="profileForm">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Name</mat-label>
        <input matInput formControlName="name" [readonly]="!isEditing" />
        <mat-error *ngIf="!profileForm.get('name')?.valid && profileForm.get('name')?.touched">Please enter a valid name.</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Email</mat-label>
        <input matInput type="email" formControlName="email" [readonly]="true" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Role</mat-label>
        <input matInput formControlName="role" [readonly]="true" />
      </mat-form-field>
    </form>

    <div *ngIf="favouriteAnimals.length > 0">
      <h3>Your Favourite Pets:</h3>
      <mat-list>
        <mat-list-item *ngFor="let pet of favouriteAnimals" (click)="goToPetDetails(pet._id)" style="cursor: pointer;">
          <span style="text-decoration: underline;">{{ pet.name }}</span>, age: {{ pet.age }}, gender: {{ pet.gender }}
        </mat-list-item>
      </mat-list>
    </div>

    <div>
      <h3>Adoption Requests:</h3>
      <mat-card-actions>
        <button mat-raised-button (click)="goToAdopt()">Adoption requests</button>
      </mat-card-actions>
    </div>
  </mat-card-content>

  <mat-card-actions>
    <button mat-raised-button color="primary" *ngIf="isAdmin" (click)="goToAdmin()">Admin Panel</button>
    <button mat-flat-button class="delete-btn" (click)="deletePopupShow()">Delete Account</button>
  </mat-card-actions>
</mat-card>

<div *ngIf="showDeletePopup" class="popup-backdrop">
  <div class="popup-content">
    <h3>Biztos, hogy törlöd véglegesen az accountod?</h3>
    <div class="popup-buttons">
      <button mat-raised-button color="warn" (click)="deleteAccount()">Igen</button>
      <button mat-stroked-button (click)="closeDeletePopup()">Mégse</button>
    </div>
  </div>
</div>
